# 企业管理页面使用指南

## 页面概览

企业管理页面位于侧边栏导航的"🏢 企业管理"选项，提供完整的企业信息管理功能。

## 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│  🏢 企业管理                                                      │
├─────────────────────────────────────────────────────────────────┤
│  💡 管理企业信息，每个企业拥有独立的职位分类体系                  │
├──────────────────────────────────┬──────────────────────────────┤
│  📊 企业列表 (左侧 2/3)           │  ➕ 创建新企业 (右侧 1/3)     │
│                                  │                              │
│  ┌────────────────────────────┐ │  ┌────────────────────────┐ │
│  │ 🏢 科技有限公司              │ │  │ 企业名称*              │ │
│  │                            │ │  │ [输入框]               │ │
│  │ 企业ID: comp_abc123        │ │  │                        │ │
│  │ 创建时间: 2024-01-15       │ │  │ 说明                   │ │
│  │ 更新时间: 2024-01-15       │ │  │ 创建企业后，您可以：    │ │
│  │                            │ │  │ - 建立职位分类体系      │ │
│  │ 统计信息                    │ │  │ - 管理岗位JD           │ │
│  │ [职位分类: 5]              │ │  │ - 查看统计信息         │ │
│  │ [JD数量: 0]                │ │  │                        │ │
│  │ [标签数量: 0]              │ │  │ [✅ 创建企业]          │ │
│  │                            │ │  └────────────────────────┘ │
│  │ [📋 查看详情]              │ │                              │
│  │ [✏️ 编辑]                  │ │  ───────────────────────── │
│  │ [🗑️ 删除]                  │ │                              │
│  └────────────────────────────┘ │  💡 使用说明                │
│                                  │  [查看详细说明]             │
│  ┌────────────────────────────┐ │                              │
│  │ 🏢 互联网公司                │ │                              │
│  │ ...                        │ │                              │
│  └────────────────────────────┘ │                              │
└──────────────────────────────────┴──────────────────────────────┘
```

## 功能详解

### 1. 企业列表展示

#### 1.1 企业卡片

每个企业以可展开的卡片形式显示：

```
🏢 科技有限公司
├─ 企业ID: comp_abc123
├─ 创建时间: 2024-01-15 10:30:00
├─ 更新时间: 2024-01-15 10:30:00
├─ 统计信息
│  ├─ 职位分类: 5
│  ├─ JD数量: 0
│  └─ 标签数量: 0
└─ 操作按钮
   ├─ 📋 查看详情
   ├─ ✏️ 编辑
   └─ 🗑️ 删除
```

#### 1.2 统计信息

使用 Streamlit 的 `st.metric` 组件显示三个关键指标：

```
┌──────────────┬──────────────┬──────────────┐
│ 职位分类      │ JD数量        │ 标签数量      │
│    5         │    0         │    0         │
└──────────────┴──────────────┴──────────────┘
```

### 2. 查看企业详情

点击"📋 查看详情"按钮后，展开企业详细信息：

```
───────────────────────────────────────────────
📋 企业详情

### 🏢 科技有限公司

企业ID: comp_abc123
创建时间: 2024-01-15 10:30:00
更新时间: 2024-01-15 10:30:00

───────────────────────────────────────────────
#### 📊 职位分类体系

📁 技术类 (L1)
　　技术相关职位
　📂 研发 (L2)
　　　研发相关职位
　　📄 后端工程师 (L3)
　　　　后端开发职位
　　　　样本JD: 2 个
　　📄 前端工程师 (L3)
　　　　前端开发职位
　　　　样本JD: 1 个

📁 业务类 (L1)
　　业务相关职位
　📂 销售 (L2)
　　　销售相关职位
　　📄 销售经理 (L3)
　　　　销售管理职位

[❌ 关闭详情]
```

### 3. 创建企业

右侧表单用于创建新企业：

```
┌────────────────────────────────┐
│ ➕ 创建新企业                   │
├────────────────────────────────┤
│                                │
│ 企业名称*                       │
│ ┌────────────────────────────┐ │
│ │ 例如：科技有限公司           │ │
│ └────────────────────────────┘ │
│                                │
│ ───────────────────────────── │
│ 说明                           │
│ 💡 创建企业后，您可以：         │
│    - 为企业建立独立的职位分类体系│
│    - 管理企业的岗位JD           │
│    - 查看企业的统计信息         │
│                                │
│ [✅ 创建企业]                  │
│                                │
│ ───────────────────────────── │
│ 💡 使用说明                    │
│ [查看详细说明]                 │
└────────────────────────────────┘
```

#### 创建成功提示

```
✅ 企业创建成功！
企业ID: comp_xyz789
企业名称: 科技有限公司
💡 您现在可以在左侧查看企业详情，或前往'职位分类管理'页面为企业创建分类体系
```

### 4. 编辑企业

点击"✏️ 编辑"按钮后，显示编辑表单：

```
───────────────────────────────────────────────
✏️ 编辑企业

┌────────────────────────────────────────────┐
│ 企业名称*                                   │
│ ┌────────────────────────────────────────┐ │
│ │ 科技有限公司                            │ │
│ └────────────────────────────────────────┘ │
│                                            │
│ ┌──────────────┬──────────────────────────┐│
│ │ [💾 保存]    │ [❌ 取消]                ││
│ └──────────────┴──────────────────────────┘│
└────────────────────────────────────────────┘
```

#### 更新成功提示

```
✅ 企业更新成功！
```

### 5. 删除企业

点击"🗑️ 删除"按钮后，显示确认对话框：

```
───────────────────────────────────────────────
⚠️ 删除企业确认

⚠️ 删除企业将同时删除该企业下的所有职位分类和标签

🚨 您即将删除企业 **科技有限公司**，这将同时删除该企业下的 **5** 个职位分类及其所有标签！

**此操作不可撤销，请谨慎操作！**

┌──────────────┬──────────────────────────┐
│ [🗑️ 确认删除] │ [❌ 取消]                │
└──────────────┴──────────────────────────┘
```

#### 删除成功提示

```
✅ 企业删除成功，已同时删除 5 个职位分类
```

## 操作流程

### 流程1：创建新企业

```
1. 进入"🏢 企业管理"页面
   ↓
2. 在右侧表单输入企业名称
   ↓
3. 点击"✅ 创建企业"按钮
   ↓
4. 查看创建成功提示
   ↓
5. 在左侧企业列表中看到新企业
```

### 流程2：查看企业详情

```
1. 在企业列表中找到目标企业
   ↓
2. 点击"📋 查看详情"按钮
   ↓
3. 查看企业基本信息
   ↓
4. 查看企业的职位分类树
   ↓
5. 点击"❌ 关闭详情"返回列表
```

### 流程3：编辑企业名称

```
1. 在企业列表中找到目标企业
   ↓
2. 点击"✏️ 编辑"按钮
   ↓
3. 修改企业名称
   ↓
4. 点击"💾 保存"按钮
   ↓
5. 查看更新成功提示
```

### 流程4：删除企业

```
1. 在企业列表中找到目标企业
   ↓
2. 点击"🗑️ 删除"按钮
   ↓
3. 查看警告信息和关联数据统计
   ↓
4. 确认要删除
   ↓
5. 点击"🗑️ 确认删除"按钮
   ↓
6. 查看删除成功提示
```

## 错误处理

### 1. API服务未运行

```
❌ 获取企业列表时发生错误: Connection refused
💡 请检查 API 服务是否正常运行（http://localhost:8000）
```

### 2. 企业不存在

```
❌ 企业 comp_abc123 不存在
```

### 3. 创建失败

```
❌ 创建失败: 企业名称不能为空
```

### 4. 更新失败

```
❌ 更新失败: 企业不存在
```

### 5. 删除失败

```
❌ 删除失败: 企业不存在
```

## 空状态处理

当没有企业时，显示友好的提示：

```
📝 暂无企业数据，请从右侧创建第一家企业

**快速开始：**
1. 在右侧表单中输入企业名称
2. 点击"创建企业"按钮
3. 为企业创建职位分类体系
```

## 使用说明（展开）

点击右侧"💡 使用说明"下的"查看详细说明"，展开完整说明：

```
### 企业管理功能说明

**功能概述：**
- 创建和管理企业信息
- 每个企业拥有独立的职位分类体系
- 查看企业统计信息（分类数量、JD数量等）

**操作步骤：**
1. **创建企业**：在右侧表单输入企业名称并提交
2. **查看详情**：点击企业卡片中的"查看详情"按钮
3. **编辑企业**：点击"编辑"按钮修改企业名称
4. **删除企业**：点击"删除"按钮（需确认）

**注意事项：**
- 删除企业将同时删除该企业下的所有职位分类和标签
- 删除操作不可撤销，请谨慎操作
- 建议先查看企业详情，了解关联数据后再删除

**下一步：**
- 创建企业后，前往"职位分类管理"页面
- 为企业建立职位分类体系（最多3层级）
- 为第三层级分类添加标签和样本JD
```

## API端点映射

| 功能 | API端点 | 方法 |
|------|---------|------|
| 获取企业列表 | `/api/v1/companies` | GET |
| 创建企业 | `/api/v1/companies` | POST |
| 获取企业详情 | `/api/v1/companies/{id}` | GET |
| 更新企业名称 | `/api/v1/companies/{id}` | PUT |
| 删除企业（检查） | `/api/v1/companies/{id}?confirm=false` | DELETE |
| 删除企业（确认） | `/api/v1/companies/{id}?confirm=true` | DELETE |
| 获取企业分类 | `/api/v1/companies/{id}/categories` | GET |
| 获取企业分类树 | `/api/v1/companies/{id}/categories/tree` | GET |

## 技术特性

### 1. 响应式布局

- 使用 `st.columns` 实现两列布局
- 左侧2/3宽度显示企业列表
- 右侧1/3宽度显示创建表单

### 2. 状态管理

使用 `st.session_state` 管理页面状态：

- `view_company_id`: 当前查看的企业
- `edit_company_id`: 当前编辑的企业
- `delete_company_id`: 待删除的企业

### 3. 递归显示

实现递归函数显示3层级分类树，支持无限嵌套。

### 4. 错误处理

- 使用 try-except 捕获异常
- 显示友好的错误提示
- 提供故障排查建议

### 5. 用户反馈

- 成功操作：绿色提示（st.success）
- 错误信息：红色提示（st.error）
- 警告信息：黄色提示（st.warning）
- 提示信息：蓝色提示（st.info）

## 最佳实践

### 1. 创建企业

- 使用清晰、简洁的企业名称
- 避免使用特殊字符
- 建议使用全称（如"XX科技有限公司"）

### 2. 删除企业

- 删除前先查看企业详情
- 确认没有重要数据后再删除
- 注意删除操作不可撤销

### 3. 组织结构

- 先创建企业
- 再为企业创建职位分类体系
- 最后为分类添加标签和样本JD

## 常见问题

### Q1: 为什么看不到企业列表？

A: 可能的原因：
1. API服务未启动
2. 还没有创建任何企业
3. 网络连接问题

解决方法：
1. 检查API服务是否运行
2. 尝试创建第一家企业
3. 刷新页面重试

### Q2: 删除企业后能恢复吗？

A: 不能。删除操作是永久性的，会同时删除企业下的所有数据。建议删除前先确认。

### Q3: 如何为企业创建职位分类？

A: 创建企业后，前往"🗂️ 职位分类管理"页面，选择企业并创建分类。

### Q4: 统计信息不准确怎么办？

A: 统计信息是实时从API获取的。如果不准确，可能是：
1. API数据未同步
2. 缓存问题

解决方法：刷新页面重新加载数据。

## 总结

企业管理页面提供了完整的企业信息管理功能，包括创建、查看、编辑、删除等操作。界面友好，操作简单，适合HR专业人员使用。通过企业管理，可以为不同企业建立独立的职位分类体系，实现多企业管理。
