# æ–‡ä»¶ä¸Šä¼  API é›†æˆ

## æ›´æ–°è¯´æ˜

å·²å°†æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ä¿®æ”¹ä¸ºé€šè¿‡ API æœåŠ¡å™¨ç«¯å¤„ç†ï¼Œè€Œä¸æ˜¯å®¢æˆ·ç«¯æœ¬åœ°å¤„ç†ã€‚

## å˜æ›´å†…å®¹

### ä¹‹å‰ï¼ˆæœ¬åœ°å¤„ç†ï¼‰

```python
# UI æœ¬åœ°è§£ææ–‡ä»¶
file_content = uploaded_file.read()
jd_text = file_parser.parse_file(file_content, uploaded_file.name)
result = run_async(mcp_client.analyze_jd(jd_text, model_type))
```

**ä¼˜ç‚¹**ï¼š
- âœ… ä¸éœ€è¦ API æœåŠ¡
- âœ… å¤„ç†é€Ÿåº¦å¿«

**ç¼ºç‚¹**ï¼š
- âŒ æ–‡ä»¶è§£æåœ¨å®¢æˆ·ç«¯
- âŒ æ— æ³•ç»Ÿä¸€ç®¡ç†
- âŒ å¯èƒ½æœ‰å®‰å…¨é—®é¢˜

### ç°åœ¨ï¼ˆæœåŠ¡å™¨å¤„ç†ï¼‰

```python
# ä¸Šä¼ æ–‡ä»¶åˆ° API
files = {'file': (uploaded_file.name, uploaded_file.getvalue(), uploaded_file.type)}
response = api_request("POST", f"/jd/upload?model_type={model_type}", files=files)
```

**ä¼˜ç‚¹**ï¼š
- âœ… æœåŠ¡å™¨ç«¯ç»Ÿä¸€å¤„ç†
- âœ… æ›´å®‰å…¨
- âœ… ä¾¿äºç®¡ç†å’Œç›‘æ§
- âœ… ç¬¦åˆæ ‡å‡† Web æ¶æ„

**ç¼ºç‚¹**ï¼š
- âš ï¸ éœ€è¦ API æœåŠ¡è¿è¡Œ

## æ¶æ„å˜åŒ–

### ä¹‹å‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Streamlit  â”‚
â”‚     UI      â”‚
â”‚             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚File     â”‚ â”‚
â”‚ â”‚Parser   â”‚ â”‚  â† æœ¬åœ°è§£æ
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Simple   â”‚ â”‚
â”‚ â”‚MCP      â”‚ â”‚  â† æœ¬åœ°åˆ†æ
â”‚ â”‚Client   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç°åœ¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Streamlit  â”‚         â”‚   FastAPI   â”‚
â”‚     UI      â”‚         â”‚   Server    â”‚
â”‚             â”‚         â”‚             â”‚
â”‚             â”‚  HTTP   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  ä¸Šä¼ æ–‡ä»¶   â”œâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚ â”‚File     â”‚ â”‚
â”‚             â”‚         â”‚ â”‚Parser   â”‚ â”‚
â”‚             â”‚         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚             â”‚         â”‚             â”‚
â”‚             â”‚         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚             â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚Simple   â”‚ â”‚
â”‚  æ˜¾ç¤ºç»“æœ   â”‚  JSON   â”‚ â”‚MCP      â”‚ â”‚
â”‚             â”‚         â”‚ â”‚Client   â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä½¿ç”¨è¯´æ˜

### å‰ææ¡ä»¶

**å¿…é¡»å¯åŠ¨ API æœåŠ¡**ï¼š

```bash
# æ–¹å¼ 1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬
start_services.bat

# æ–¹å¼ 2ï¼šæ‰‹åŠ¨å¯åŠ¨
python -m uvicorn src.api.main:app --reload --port 8000
```

### ä½¿ç”¨æ­¥éª¤

1. ç¡®ä¿ API æœåŠ¡è¿è¡Œåœ¨ http://localhost:8000
2. è®¿é—® UIï¼šhttp://localhost:8501
3. é€‰æ‹©"æ–‡ä»¶ä¸Šä¼ "æ–¹å¼
4. ä¸Šä¼  JD æ–‡ä»¶ï¼ˆTXT/PDF/DOCXï¼‰
5. ç‚¹å‡»"å¼€å§‹åˆ†æ"
6. ç­‰å¾…æœåŠ¡å™¨å¤„ç†
7. æŸ¥çœ‹åˆ†æç»“æœ

### API ç«¯ç‚¹

```
POST /api/v1/jd/upload
```

**å‚æ•°**ï¼š
- `file`: ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆmultipart/form-dataï¼‰
- `model_type`: è¯„ä¼°æ¨¡å‹ç±»å‹ï¼ˆquery parameterï¼‰

**å“åº”**ï¼š
```json
{
    "success": true,
    "message": "æ–‡ä»¶ xxx.txt åˆ†æå®Œæˆ",
    "data": {
        "jd": { ... },
        "evaluation": { ... }
    }
}
```

## é”™è¯¯å¤„ç†

### é”™è¯¯ 1ï¼šAPI æœåŠ¡æœªè¿è¡Œ

```
âŒ æ–‡ä»¶ä¸Šä¼ å¤±è´¥: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded
ğŸ’¡ æç¤ºï¼šè¯·ç¡®ä¿ API æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆhttp://localhost:8000ï¼‰
```

**è§£å†³**ï¼šå¯åŠ¨ API æœåŠ¡

### é”™è¯¯ 2ï¼šæ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ

```
âŒ æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼
```

**è§£å†³**ï¼šä½¿ç”¨ TXTã€PDF æˆ– DOCX æ ¼å¼

### é”™è¯¯ 3ï¼šæ–‡ä»¶å¤ªå¤§

```
âŒ æ–‡ä»¶ä¸Šä¼ å¤±è´¥: æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶
```

**è§£å†³**ï¼šæ–‡ä»¶å¤§å°åº”å°äº 10MB

## åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | æœ¬åœ°å¤„ç† | API å¤„ç† |
|------|---------|---------|
| éœ€è¦ API | âŒ | âœ… |
| å¤„ç†é€Ÿåº¦ | å¿« | ä¸­ç­‰ |
| å®‰å…¨æ€§ | ä½ | é«˜ |
| å¯ç®¡ç†æ€§ | ä½ | é«˜ |
| ç»Ÿä¸€æ€§ | ä½ | é«˜ |
| é€‚ç”¨åœºæ™¯ | å¼€å‘æµ‹è¯• | ç”Ÿäº§ç¯å¢ƒ |

## æ›¿ä»£æ–¹æ¡ˆ

å¦‚æœ API æœåŠ¡æ— æ³•å¯åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨ï¼š

### æ–¹æ¡ˆ 1ï¼šæ–‡æœ¬è¾“å…¥

1. æ‰‹åŠ¨æ‰“å¼€æ–‡ä»¶
2. å¤åˆ¶å†…å®¹
3. ä½¿ç”¨"æ–‡æœ¬è¾“å…¥"æ–¹å¼
4. ç²˜è´´å¹¶åˆ†æ

### æ–¹æ¡ˆ 2ï¼šæ‰¹é‡ä¸Šä¼ 

æ‰¹é‡ä¸Šä¼ åŠŸèƒ½ä»ç„¶ä½¿ç”¨æœ¬åœ°å¤„ç†ï¼ˆæš‚æœªä¿®æ”¹ï¼‰ã€‚

## æµ‹è¯•

### æµ‹è¯•æ­¥éª¤

1. å¯åŠ¨ API æœåŠ¡
2. å¯åŠ¨ UI æœåŠ¡
3. å‡†å¤‡æµ‹è¯•æ–‡ä»¶ï¼ˆtest.txtï¼‰ï¼š
```
èŒä½ï¼šæµ‹è¯•å·¥ç¨‹å¸ˆ
èŒè´£ï¼šè´Ÿè´£æµ‹è¯•å·¥ä½œ
è¦æ±‚ï¼š3å¹´ç»éªŒ
```
4. ä¸Šä¼ æ–‡ä»¶
5. éªŒè¯ç»“æœ

### é¢„æœŸç»“æœ

- âœ… æ–‡ä»¶æˆåŠŸä¸Šä¼ 
- âœ… æœåŠ¡å™¨è§£ææ–‡ä»¶
- âœ… è¿”å›åˆ†æç»“æœ
- âœ… UI æ˜¾ç¤ºç»“æœ

## ç›‘æ§

### API æ—¥å¿—

åœ¨ API æœåŠ¡ç»ˆç«¯æŸ¥çœ‹ï¼š
```
INFO:     127.0.0.1:xxxxx - "POST /api/v1/jd/upload?model_type=standard HTTP/1.1" 200 OK
```

### UI æ—¥å¿—

åœ¨ UI ç»ˆç«¯æŸ¥çœ‹ï¼š
```
âœ… æ–‡ä»¶ test.txt åˆ†æå®Œæˆï¼
```

## é…ç½®

### API é…ç½®

åœ¨ `src/api/routers/jd.py` ä¸­ï¼š

```python
@router.post("/upload", response_model=Dict[str, Any])
async def upload_jd_file(
    file: UploadFile = File(...),
    model_type: EvaluationModel = EvaluationModel.STANDARD
):
    # æ–‡ä»¶ä¸Šä¼ å¤„ç†é€»è¾‘
    ...
```

### UI é…ç½®

åœ¨ `src/ui/app.py` ä¸­ï¼š

```python
# API åŸºç¡€ URL
API_BASE_URL = os.getenv("API_BASE_URL", "http://localhost:8000/api/v1")
```

å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ä¿®æ”¹ API åœ°å€ã€‚

## ä¼˜åŠ¿

### 1. ç»Ÿä¸€å¤„ç†

æ‰€æœ‰æ–‡ä»¶è§£æéƒ½åœ¨æœåŠ¡å™¨ç«¯ï¼Œä¾¿äºï¼š
- ç»Ÿä¸€é”™è¯¯å¤„ç†
- ç»Ÿä¸€æ—¥å¿—è®°å½•
- ç»Ÿä¸€æ€§èƒ½ç›‘æ§

### 2. å®‰å…¨æ€§

- æ–‡ä»¶åœ¨æœåŠ¡å™¨ç«¯éªŒè¯
- é˜²æ­¢æ¶æ„æ–‡ä»¶
- æ§åˆ¶æ–‡ä»¶å¤§å°

### 3. å¯æ‰©å±•æ€§

- æ˜“äºæ·»åŠ æ–‡ä»¶å­˜å‚¨
- æ˜“äºæ·»åŠ æ–‡ä»¶å†å²
- æ˜“äºå®ç°æ–‡ä»¶å…±äº«

### 4. æ ‡å‡†æ¶æ„

- ç¬¦åˆå‰åç«¯åˆ†ç¦»
- ä¾¿äºéƒ¨ç½²å’Œæ‰©å±•
- ä¾¿äºå›¢é˜Ÿåä½œ

## æ€»ç»“

æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å·²æ”¹ä¸ºé€šè¿‡ API æœåŠ¡å™¨ç«¯å¤„ç†ï¼Œæä¾›äº†æ›´å¥½çš„å®‰å…¨æ€§ã€å¯ç®¡ç†æ€§å’Œå¯æ‰©å±•æ€§ã€‚

**é‡è¦**ï¼šä½¿ç”¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å‰ï¼Œè¯·ç¡®ä¿ API æœåŠ¡æ­£åœ¨è¿è¡Œï¼

---

**æ›´æ–°æ—¥æœŸ**: 2024å¹´  
**æ›´æ–°äºº**: Kiro AI Assistant
